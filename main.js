(()=>{"use strict";var e=document.querySelectorAll(".popup"),t=document.querySelector(".popup-edit"),n=document.querySelector(".popup-add"),o=document.querySelector(".popup-picture"),c=document.querySelector(".popup-avatar"),r=o.querySelector(".popup-picture__image"),a=o.querySelector(".popup-picture__caption"),i=document.forms.edit,u=document.forms.add,s=document.forms.avatar,l=i.elements.name,d=i.elements.about,f=u.elements.title,m=u.elements.link,p=s.querySelector("#avatar-link"),h=document.querySelector(".profile__avatar"),v=document.querySelector(".profile__name"),_=document.querySelector(".profile__about"),y=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-button"),S=document.querySelector(".profile__avatar-edit-button"),k=document.querySelector(".gallery"),E={id:"",name:""},L=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",g)},q=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",g)},g=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");L(t)}},C={baseUrl:"https://nomoreparties.co/v1/plus-cohort-20",headers:{authorization:"c29acbcd-e400-4694-90fd-37fde0fe5a19","Content-Type":"application/json"}},j=function(e,t){e.length>0?(t.classList.add("card__like-counter_active"),t.textContent=e.length):(t.classList.remove("card__like-counter_active"),t.textContent="")},x=function(e,t){e.forEach((function(e){e.name===E.name&&t.classList.add("card__like-button_active")}))},P=function(e){var t,n,c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),i=c.querySelector(".card__photo"),u=c.querySelector(".card__trash-button"),s=c.querySelector(".card__like-counter"),l=c.querySelector(".card__like-button");return c.querySelector(".card__title").textContent=e.name,i.src=e.link,i.alt=e.name,l.addEventListener("click",(function(t){var n;t.target.classList.contains("card__like-button_active")?(n=e._id,fetch("".concat(C.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:C.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){j(e.likes,s),t.target.classList.remove("card__like-button_active")})):function(e){return fetch("".concat(C.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:C.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(e._id).then((function(e){j(e.likes,s),x(e.likes,t.target)}))})),u.addEventListener("click",(function(t){var n;(n=e._id,fetch("".concat(C.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:C.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(){t.target.closest(".card").remove()}))})),i.addEventListener("click",(function(){q(o),r.src=i.src,r.alt=i.alt,a.textContent=i.alt})),t=e.owner._id,n=u,E.id!==t&&n.remove(),j(e.likes,s),x(e.likes,l),c},T=function(e,t){t.prepend(e)},U=function(e,t){var n=t.target.querySelector(".form__button");n.textContent=e?n.dataset.saving:n.dataset.save};e.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&L(e),t.target.classList.contains("popup__close-button")&&L(e)}))})),y.addEventListener("click",(function(){q(t),l.value=v.textContent,d.value=_.textContent})),b.addEventListener("click",(function(){q(n)})),S.addEventListener("click",(function(){q(c)})),s.addEventListener("submit",(function(e){e.preventDefault(),U(!0,e),function(e){return fetch("".concat(C.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:C.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(p.value).then((function(e){h.src=e.avatar})).finally((function(){U(!1,e),L(c),e.target.reset()}))})),i.addEventListener("submit",(function(e){e.preventDefault(),U(!0,e),function(e,t){return fetch("".concat(C.baseUrl,"/users/me"),{method:"PATCH",headers:C.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}(l.value,d.value).then((function(e){v.textContent=e.name,_.textContent=e.about})).finally((function(){U(!1,e),L(t)}))})),u.addEventListener("submit",(function(e){e.preventDefault(),U(!0,e),function(e,t){return fetch("".concat(C.baseUrl,"/cards"),{method:"POST",headers:C.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(f.value,m.value).then((function(e){T(P(e),k)})).finally((function(){U(!1,e),L(n),e.target.reset()}))})),function(e){var t=function(t,n,o){var c=t.querySelector(".".concat(n.id,"-error"));n.classList.add("".concat(e.inputErrorClass)),c.textContent=o,c.classList.add("".concat(e.errorClass))},n=function(t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.disabled=!1,n.classList.remove("".concat(e.inactiveButtonClass))):(n.disabled=!0,n.classList.add("".concat(e.inactiveButtonClass)))};Array.from(document.querySelectorAll("".concat(e.formSelector))).forEach((function(o){!function(o){var c=Array.from(o.querySelectorAll("".concat(e.inputSelector))),r=o.querySelector("".concat(e.submitButtonSelector));n(c,r),o.addEventListener("reset",(function(){setTimeout((function(){n(c,r)}),0)})),c.forEach((function(a){a.addEventListener("input",(function(){(function(n,o){o.validity.patternMismatch?t(n,o,o.dataset.error):o.validity.valid?function(t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove("".concat(e.inputErrorClass)),o.textContent=""}(n,o):t(n,o,o.validationMessage)})(o,a),n(c,r)}))}))}(o)}))}({formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__error_visible"}),new Promise((function(e,t){window.onload=e,window.onerror=t})).then((function(){return fetch("".concat(C.baseUrl,"/users/me"),{method:"GET",headers:C.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){v.textContent=e.name,_.textContent=e.about,h.src=e.avatar,E.id=e._id,E.name=e.name}))})).then((function(){fetch("".concat(C.baseUrl,"/cards"),{method:"GET",headers:C.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){!function(e,t){e.reverse().forEach((function(e){var n=P(e);T(n,t)}))}(e,k)}))})).catch((function(e){console.log(e)}))})();